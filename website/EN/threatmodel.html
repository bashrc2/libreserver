<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-04-15 Thu 10:43 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LibreServer</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Bob Mottram" />
<meta name="description" content="Threat model for the LibreServer home server system"
 />
<meta name="keywords" content="libreserver, threat model" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="libreserver.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">LibreServer</h1>

<div class="figure">
<p><img src="images/logo.png" alt="logo.png" width="80%" height="10%" align="center" />
</p>
</div>

<div id="outline-container-orga47405e" class="outline-2">
<h2 id="orga47405e">Threat Model</h2>
<div class="outline-text-2" id="text-orga47405e">
<div class="org-center">
<table border="-1" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="#org37debfb">Expected Deployment</a></td>
</tr>

<tr>
<td class="org-left"><a href="#org822e1df">Threats</a></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org37debfb" class="outline-2">
<h2 id="org37debfb">Expected Deployment</h2>
<div class="outline-text-2" id="text-org37debfb">
</div>
<div id="outline-container-org60092a9" class="outline-3">
<h3 id="org60092a9">Located at your place of residence</h3>
<div class="outline-text-3" id="text-org60092a9">
<p>
Not in a data center or as a (Virtual Private Server) VPS. You are expected to have physical access to the hardware.
</p>
</div>
</div>
<div id="outline-container-org64e568d" class="outline-3">
<h3 id="org64e568d">You own the hardware</h3>
<div class="outline-text-3" id="text-org64e568d">
<p>
Or it could be owned by someone living at your place of residence
</p>
</div>
</div>
<div id="outline-container-orgf3bd1c8" class="outline-3">
<h3 id="orgf3bd1c8">Running on an ARM single board computer or desktop/laptop/netbook</h3>
<div class="outline-text-3" id="text-orgf3bd1c8">
<p>
Not (yet) intended to run on tablets or phones, though that might become possible in future.
</p>
</div>
</div>
<div id="outline-container-orgdfeecf3" class="outline-3">
<h3 id="orgdfeecf3">Running on Debian</h3>
<div class="outline-text-3" id="text-orgdfeecf3">
<p>
The stable version, or a closely related derivative such as Armbian
</p>
</div>
</div>
<div id="outline-container-orgccc54e0" class="outline-3">
<h3 id="orgccc54e0">Continuous operation</h3>
<div class="outline-text-3" id="text-orgccc54e0">
<p>
The system runs continuously 24/7. Power downs are not expected under normal use.
</p>
</div>
</div>
</div>
<div id="outline-container-org822e1df" class="outline-2">
<h2 id="org822e1df">Threats</h2>
<div class="outline-text-2" id="text-org822e1df">
</div>
<div id="outline-container-org5943bd7" class="outline-3">
<h3 id="org5943bd7">Adversary gains access to uninstalled server</h3>
<div class="outline-text-3" id="text-org5943bd7">
<p>
You might copy an image to a drive, power on your server and then do something else for a few hours or days. An adversary could ssh in using the default password and add an implant.
</p>

<p>
To mitigate this, your're forced to change the default password on first login and the adversary would also have to do this. So if you havn't yet installed the system but you notice that you can't do the initial login then this indicates that the system could be compromised.
</p>
</div>
</div>
<div id="outline-container-orga2f2ace" class="outline-3">
<h3 id="orga2f2ace">USB port access</h3>
<div class="outline-text-3" id="text-orga2f2ace">
<p>
Anyone at your place of residence could plug in external devices, such as USB sticks. The system has a <i>USB canary</i> feature which informs the administrator if a USB device has been plugged in or removed, but it doesn't prevent the delivery of malicious payloads via USB.
</p>
</div>
</div>
<div id="outline-container-orge8dca50" class="outline-3">
<h3 id="orge8dca50">Serial console access</h3>
<div class="outline-text-3" id="text-orge8dca50">
<p>
This is useful for diagnosing boot sequence problems but could also be used as a way of logging into the system. Even if an adversary within your household connects a serial cable to the relevant pins they still need to know the admin password, or password of another member, to be able to log in and do anything harmful.
</p>
</div>
</div>
<div id="outline-container-org964bad8" class="outline-3">
<h3 id="org964bad8">Exploitation of CPU design flaws</h3>
<div class="outline-text-3" id="text-org964bad8">
<p>
Currently many CPUs used on laptops or single board computers are vulnerable to Spectre type bugs which are difficult to mitigate in software. However, these design flaws are most exploitable within a different kind of deployment, such as shared hosting within a data center in which multiple virtual machines are running on the same CPU. That kind of threat doesn't apply in the self-hosted situation where the hardware is in your home under your direct supervision.
</p>
</div>
</div>
<div id="outline-container-orgc095db4" class="outline-3">
<h3 id="orgc095db4">ssh access using default password</h3>
<div class="outline-text-3" id="text-orgc095db4">
<p>
By default ssh access to the system, even from within the local network, is not enabled. There is also no default password and instead a random password is generated on first boot and shown during the setup procedure.
</p>
</div>
</div>
<div id="outline-container-orgc0aabc4" class="outline-3">
<h3 id="orgc0aabc4">Access to the web interface</h3>
<div class="outline-text-3" id="text-orgc0aabc4">
<p>
Anyone with access to the administrator part of the web interface could potentially cause significant trouble, such as uninstalling apps or changing DNS settings. Access to the web interface is restricted in a few ways:
</p>

<ul class="org-ul">
<li>Login password needed via web server authentication method</li>
<li>There is no clearnet access to the web interface via ports 80 or 443</li>
<li>Remote access is only enabled via an onion address. An adversary needs to know both the address and the login password.</li>
</ul>
</div>
</div>
<div id="outline-container-org1dd4f5a" class="outline-3">
<h3 id="org1dd4f5a">Adversary uses an out of band method to run web interface scripts</h3>
<div class="outline-text-3" id="text-org1dd4f5a">
<p>
Scripts which are run from the web interface are restricted to only being executable via that interface. So trying to run them via the commandline or another method should not be possible.
</p>
</div>
</div>
<div id="outline-container-orgef7eb11" class="outline-3">
<h3 id="orgef7eb11">icmp based exploits</h3>
<div class="outline-text-3" id="text-orgef7eb11">
<p>
Such as "ping of death". icmp is a sufficiently boring aspect of servers that probably the code hasn't had a lot of oversight in recent years. To mitigate possible exploits icmp is turned off by default.
</p>
</div>
</div>
<div id="outline-container-org9d57d29" class="outline-3">
<h3 id="org9d57d29">Adversary determines running applications via a port scan</h3>
<div class="outline-text-3" id="text-org9d57d29">
<p>
The system tries to detect port scanning and adds a 24 hour firewall block to any IP address from which a scan appears to originate.
</p>
</div>
</div>
<div id="outline-container-org67b78b5" class="outline-3">
<h3 id="org67b78b5">Denial of service attack</h3>
<div class="outline-text-3" id="text-org67b78b5">
<p>
The mitigations against this are fairly limited and so denial of service attacks are a possible way in which the system could fail. There are rate limits at the firewall level and also within the web server configuration. Where it's relevant the number of connected users for an app is limited to ten or fewer.
</p>
</div>
</div>
<div id="outline-container-org9c69b0c" class="outline-3">
<h3 id="org9c69b0c">Adversary runs an exploit from /tmp</h3>
<div class="outline-text-3" id="text-org9c69b0c">
<p>
Execute permissions for the /tmp directory are denied. Also the directory size of /tmp is quite small, so trying to run a large program from there or use it as a way of transferring a lot of data would be more difficult.
</p>
</div>
</div>
<div id="outline-container-org3b2da2e" class="outline-3">
<h3 id="org3b2da2e">Adversary changes permissions</h3>
<div class="outline-text-3" id="text-org3b2da2e">
<p>
The system periodically runs tests to check permissions on critical files and directories. If a problem is found then permissions are automatically reset and a report is sent to the administrator.
</p>
</div>
</div>
<div id="outline-container-org5253b27" class="outline-3">
<h3 id="org5253b27">Obtaining IP addresses from logs</h3>
<div class="outline-text-3" id="text-org5253b27">
<p>
For example, suppose that an authority orders you to hand over your server and they then search it to try to find out who has been reading your blog. Logging is turned off by default, so there are no IP addresses to be discovered.
</p>
</div>
</div>
<div id="outline-container-org6f2e50e" class="outline-3">
<h3 id="org6f2e50e">You want to use onion addresses but Tor is blocked in your area</h3>
<div class="outline-text-3" id="text-org6f2e50e">
<p>
You can add Tor bridges via the settings screen of the web interface.
</p>
</div>
</div>
<div id="outline-container-orga5a0015" class="outline-3">
<h3 id="orga5a0015">Harrassment</h3>
<div class="outline-text-3" id="text-orga5a0015">
<p>
An adversary sends you repeated unwanted correspondence, to intimidate, annoy or manipulate (psychological warfare). It is possible to block addresses or domains for email and XMPP systems from the blocking controls within the web interface settings screen. Systems like Hubzilla and Zap have more sophisticated controls over how other users can interact with you, such as who can reply to posts. Blocked emails are dropped at the email server level. An adversary can repeatedly change their address, but domain based blocking may limit their ability to mutate.
</p>

<p>
Advanced adversaries with financial resources may be able to rapidly spin up throwaway VMs or containers on different domains and this is hard to defend against. On the blocking controls screen there is also the ability to block communications containing certain words, and this could help in such cases.
</p>
</div>
</div>
<div id="outline-container-org316c11d" class="outline-3">
<h3 id="org316c11d">Adversary tries to get illegal content onto your server</h3>
<div class="outline-text-3" id="text-org316c11d">
<p>
So that they can then call law enforcement on you. The laws in some jurisdictions mandate that illegal content be removed within a few hours of discovery (or an even shorted time), and this may be difficult to comply with if your are running a small site and are asleep, at work or otherwise not continuously monitoring your server.
</p>

<p>
Wherever possible, content may only be added by authorized members on the system. Possible exceptions to this might be attachments within XMPP multi user chat or Matrix rooms. If this is a potential hazard then it is possible to create private Matrix rooms and restrict access to XMPP chat.
</p>
</div>
</div>
<div id="outline-container-org3ce922e" class="outline-3">
<h3 id="org3ce922e">Adversary controls the internet router at your place of residence</h3>
<div class="outline-text-3" id="text-org3ce922e">
<p>
You have physical access to the internet router to connect your server but don't have login credentials for it and are not likely to be authorized. Perhaps you are a kid whose parents don't want you messing with their internet setup, or someone in an abusive relationship. In this case you can use the onion version of the system, which doesn't require port forwarding from the internet router. It will mean that your content is only available via onion addresses, but you will still have an independent internet presence.
</p>
</div>
</div>
<div id="outline-container-org48e4ebb" class="outline-3">
<h3 id="org48e4ebb">Adversary fingerprints your server via cron activity</h3>
<div class="outline-text-3" id="text-org48e4ebb">
<p>
The times at which the main cron tasks run are randomized for each install of the system. A passive adversary should not be able to identify LibreServer systems via a particular pattern of cron activity.
</p>
</div>
</div>
<div id="outline-container-org76f9842" class="outline-3">
<h3 id="org76f9842">Protection of data at rest</h3>
<div class="outline-text-3" id="text-org76f9842">
<p>
Currently full disk encryption is not enabled and this is a deliberate security tradeoff. Full disk encryption only protects data when the system is powered off and this system is intended to run continuously. If your server is obtained by an adversary then they may be able to read any data stored on it. This may be partly mitigated due to logging being turned off and there being no logged IP addresses.
</p>

<p>
Full disk encryption requires authentication on boot and this system is intended to be operational even in the presence of occasional electrical power cuts. The small benefit which it would provide is greatly outweighed by the advantages of being able to maintain a continuous internet presence despite some level of unreliability of the surrounding infrastructure.
</p>
</div>
</div>
<div id="outline-container-orgd255524" class="outline-3">
<h3 id="orgd255524">Insufficient entropy</h3>
<div class="outline-text-3" id="text-orgd255524">
<p>
Entropy level is checked before the creation of new passwords.
</p>

<p>
Some single board computers like the Beaglebone Black have their own hardware random number generators. The quality of these is unknown and their design could be a trade secret of the chip manufacturer. This is difficult to mitigate, but USB hardware random number generators based upon published schematics are available if this is a concern.
</p>
</div>
</div>
<div id="outline-container-org867c9fa" class="outline-3">
<h3 id="org867c9fa">Adversary uses a known debian exploit</h3>
<div class="outline-text-3" id="text-org867c9fa">
<p>
Security updates are applied automatically. Since new exploits are always being found this isn't perfect but may defend you against already known issues.
</p>
</div>
</div>
<div id="outline-container-org4763ffe" class="outline-3">
<h3 id="org4763ffe">Adversary tries to modify debian package downloads</h3>
<div class="outline-text-3" id="text-org4763ffe">
<p>
https transport is enabled for package downloads and also the debian repo GPG keys are regularly checked via STIG tests. If the debian repo public keys change then the administrator will be alerted.
</p>
</div>
</div>
<div id="outline-container-orgdfae82e" class="outline-3">
<h3 id="orgdfae82e">Passive bulk surveillance</h3>
<div class="outline-text-3" id="text-orgdfae82e">
<p>
For the standard install https is used with LetsEncrypt ceryificates. http is redirected to https. Recording of DNS lookups may still be a problem. If you access your apps via their onion addresses then this makes it difficult for passive surveillance to obtain any useful personally identifiable information.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Bob Mottram</p>
<p class="date">Created: 2021-04-15 Thu 10:43</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
